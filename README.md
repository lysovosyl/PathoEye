
## Table of Contents

- [Background](#background)
- [Data](#Data)
- [Install](#Install)
- [Example](#example-readmes)
- [Maintainers](#maintainers)
- [Contributing](#contributing)
- [License](#license)

## Background
The whole-slide images (WSI) examination of skin biopsy is the golden standard for pathological diagnosis of most skin diseases. While most studies focus on the classification tasks, an interpretable computational framework is lacking for WSI analysis. To this end, we developed PathoEye for WSI analysis in dermatology, which integrates epidermis-guided sampling, deep learning and radiomics. The established classification model using PathoEye performed better than the existing state-of-the-art methods in discriminating the young and aged skin. Moreover, PathoEye performs comparably with the existing methods in the binary classification of healthy and diseased skin while performing better in multi-classification tasks. 

## Data
This data can be downloaded from https://gtexportal.org/home/histologyPage

## Install
Make sure you have installed all the package that were list in requirements.txt
```
conda create -n PathoEye python==3.8
pip install -r requirements.txt
conda activate PathoEye
```

# Example

## Step by step

### Epidermis thickness and the variance of rete ridge length calculation
The following example assumes that digitized whole slide image data in well known standard formats (.svs, .ndpi, .tiff etc.) are stored under a folder named DATA_DIRECTORY
```
    DATA_DIRECTORY/
        ├──slide_1.svs
        ├──slide_1.svs
        ├──slide_2.svs
        ├──slide_3.svs
        └── ...
        
```
```sh
python thickness.py -data_dir /DATA_DIRECTORY -save_path ./save_dir
```


### Epidermis guided patch sampling
Make sure you have downloaded dataset from https://gtexportal.org/home/histologyPage and saved them in your computer.
First you should use create_patches.py to segment images on whole-slide image. 
The following example assumes that digitized whole slide image data in well known standard formats (.svs, .ndpi, .tiff etc.) are stored under a folder named TRAIN_DIRECTORY(train dataset) or VAL_DIRECTORY (validation dataset) 
```
    TRAIN_DIRECTORY/
        ├── class_1
            ├──slide_1.svs
            ├──slide_2.svs
            ├──slide_3.svs
            └── ...
        ├── class_2
            ├──slide_1.svs
            ├──slide_2.svs
            ├──slide_3.svs
            └── ...
        ├── class_3
            ├──slide_1.svs
            ├──slide_2.svs
            ├──slide_3.svs
            └── ...
        └── ...

    VAL_DIRECTORY/
        ├── class_1
            ├──slide_1.svs
            ├──slide_2.svs
            ├──slide_3.svs
            └── ...
        ├── class_2
            ├──slide_1.svs
            ├──slide_2.svs
            ├──slide_3.svs
            └── ...
        ├── class_3
            ├──slide_1.svs
            ├──slide_2.svs
            ├──slide_3.svs
            └── ...
        └── ...
```
```sh
python create_patches.py -input_path /TRAIN_DIRECTORY -save_path /TRAIN_DATASET -device cuda:0
python create_patches.py -input_path /VAL_DIRECTORY -save_path /VAL_DATASET -device cuda:0
```
The above command produces the following folder structure for each slide
```
    DATASET/
        ├── class_1
            ├──slide_1
                ├──data
                    ├──1.png
                    ├──2.png
                    └──...
                ├──mask_target.png
                └──raw_img.png
            ├──slide_2
                ├──data
                    ├──1.png
                    ├──2.png
                    └──...
                ├──mask_target.png
                └──raw_img.png
            └── ...
        ├── class_2
            ├──slide_1
                ├──data
                    ├──1.png
                    ├──2.png
                    └──...
                ├──mask_target.png
                └──raw_img.png
            ├──slide_2
                ├──data
                    ├──1.png
                    ├──2.png
                    └──...
                ├──mask_target.png
                └──raw_img.png
            └── ...
        └── ...
```

### DCNN training and classification
You can train your own model using the segmented images as input. The VAL_DATASET folder was generated by create_patches.py.
```sh
python train.py -train_path /TRAIN_DATASET -val_path /VAL_DATASET -save_path ./MODEL_SAVEPATH
```

### Image classify
You can apply the trained model to perform binary classification on the new dataset.
```sh
python inference.py -input_path /SLIDER.SVS -model_path /MODEL_SAVEPATH -save_path ./RESULT
```

## Please cited
Lin Y., Lin F., Zhang Y. et al. PathoEye: a deep learning framework for histopathological image analysis of skin tissue. Submitted.

## Maintainer

Any question, please contact [@Yusen Lin](https://github.com/lysovosyl)


### Contributors

Thank you for the helps from Dr. Jiajian Zhou, Dr. Yongjun Zhang, Dr. Feiyan Lin and Miss Jiayu Wen.

## License

[MIT](LICENSE) © Yusen Lin
